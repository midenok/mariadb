# tests for event type connect

--source include/not_embedded.inc
 
if (!$SERVER_AUDIT2_SO) {
  skip No SERVER_AUDIT2 plugin;
}

--source server_audit2_init.inc

# add rules
INSERT INTO mysql.server_audit_filters VALUES ('default','{"logging" : "off"}');
INSERT INTO mysql.server_audit_filters VALUES ('table_all','{"table_event" : "ALL"}');
INSERT INTO mysql.server_audit_filters VALUES ('table_read','{"table_event" : "READ"}');
INSERT INTO mysql.server_audit_filters VALUES ('table_write','{"table_event" : "WRITE"}');
INSERT INTO mysql.server_audit_filters VALUES ('table_create','{"table_event" : "CREATE"}');
INSERT INTO mysql.server_audit_filters VALUES ('table_alter','{"table_event" : "ALTER"}');
INSERT INTO mysql.server_audit_filters VALUES ('table_rename','{"table_event" : "RENAME"}');
INSERT INTO mysql.server_audit_filters VALUES ('table_drop','{"table_event" : "DROP"}');
INSERT INTO mysql.server_audit_filters VALUES ('table_combined','{"table_event" : ["WRITE","CREATE"]}');

SET GLOBAL server_audit_logging=on;

# test with new filter
INSERT INTO mysql.server_audit_users VALUES ('%','root','table_all');
SET GLOBAL server_audit_reload_filters=ON;

# show status to check used filter
SHOW STATUS LIKE "Server_audit_session_filter";

--source server_audit2_commands.inc

# test with new filter
UPDATE mysql.server_audit_users SET filtername= 'table_read' where host='%' and user='root';
SET GLOBAL server_audit_reload_filters=ON;

# show status to check used filter
SHOW STATUS LIKE "Server_audit_session_filter";

--source server_audit2_commands.inc

# test with new filter
UPDATE mysql.server_audit_users SET filtername= 'table_write' where host='%' and user='root';
SET GLOBAL server_audit_reload_filters=ON;

# show status to check used filter
SHOW STATUS LIKE "Server_audit_session_filter";

--source server_audit2_commands.inc

# test with new filter
UPDATE mysql.server_audit_users SET filtername= 'table_create' where host='%' and user='root';
SET GLOBAL server_audit_reload_filters=ON;

# show status to check used filter
SHOW STATUS LIKE "Server_audit_session_filter";

 --source server_audit2_commands.inc

# test with new filter
UPDATE mysql.server_audit_users SET filtername= 'table_alter' where host='%' and user='root';
SET GLOBAL server_audit_reload_filters=ON;

# show status to check used filter
SHOW STATUS LIKE "Server_audit_session_filter";

--source server_audit2_commands.inc

# test with new filter
UPDATE mysql.server_audit_users SET filtername= 'table_rename' where host='%' and user='root';
SET GLOBAL server_audit_reload_filters=ON;

# show status to check used filter
SHOW STATUS LIKE "Server_audit_session_filter";

--source server_audit2_commands.inc

# test with new filter
UPDATE mysql.server_audit_users SET filtername= 'table_drop' where host='%' and user='root';
SET GLOBAL server_audit_reload_filters=ON;

# show status to check used filter
SHOW STATUS LIKE "Server_audit_session_filter";

--source server_audit2_commands.inc

# test with new filter
UPDATE mysql.server_audit_users SET filtername= 'table_combined' where host='%' and user='root';
SET GLOBAL server_audit_reload_filters=ON;

# show status to check used filter
SHOW STATUS LIKE "Server_audit_session_filter";

--source server_audit2_commands.inc
--source server_audit2_cleanup.inc

