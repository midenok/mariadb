connection node_2;
connection node_1;
connection node_1;
connection node_2;
connection node_3;
connection node_1;
CREATE TABLE t1 (f1 INTEGER PRIMARY KEY) ENGINE=InnoDB;
connection node_3;
SET GLOBAL debug_dbug = 'd,sync.alter_opened_table';
connection node_1;
SET SESSION wsrep_osu_method=NBO;
ALTER TABLE t1 LOCK=SHARED, ADD COLUMN f2 INTEGER;;
connection node_3;
SET SESSION wsrep_sync_wait = 0;
Killing server ...
connection node_2;
INSERT INTO t1 VALUES (1,2);
INSERT INTO t1 VALUES (2,3);
INSERT INTO t1 VALUES (3,4);
INSERT INTO t1 VALUES (4,5);
INSERT INTO t1 VALUES (5,6);
connection node_3;
Performing --wsrep-recover ...
# restart
SELECT COUNT(*) = 2 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 't1';
COUNT(*) = 2
1
SELECT COUNT(*) = 5 FROM t1;
COUNT(*) = 5
1
CALL mtr.add_suppression("WSREP: no corresponding NBO begin found for NBO end source");
connection node_2;
SELECT COUNT(*) = 2 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 't1';
COUNT(*) = 2
1
SELECT COUNT(*) = 5 FROM t1;
COUNT(*) = 5
1
CALL mtr.add_suppression("WSREP: gcs_caused\\(\\) returned -1 \\(Operation not permitted\\)");
connection node_1;
SELECT COUNT(*) = 2 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 't1';
COUNT(*) = 2
1
SELECT COUNT(*) = 5 FROM t1;
COUNT(*) = 5
1
SET SESSION wsrep_OSU_method=TOI;
DROP TABLE t1;
