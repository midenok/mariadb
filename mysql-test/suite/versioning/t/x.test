--source suite/versioning/engines.inc
--source include/have_partition.inc
--source include/master-slave.inc

--echo # Case 3: fail to add history row from the past
create or replace table t1 (pk int primary key, x int);
insert into t1 values (1, 1);
--sync_slave_with_master
create or replace table t1 (pk int primary key, x int) with system versioning;
insert into t1 values (1, 1);
flush logs;
--connection master
update t1 set x= 2 where pk = 1;
update t1 set x= 3 where pk = 1;
--sync_slave_with_master
select *, row_start, row_end from t1 for system_time all;
--let $datadir= `select @@datadir`
--let $f3= query_get_value(SHOW SLAVE STATUS, Relay_Log_File, 1)
--echo # Replaying binlog...
--sleep 1
--exec $MYSQL_BINLOG $datadir/$f3| $MYSQL -S $SLAVE_MYSOCK test
--exec $MYSQL_BINLOG $datadir/$f3| $MYSQL -S $SLAVE_MYSOCK test
select *, row_start, row_end from t1 for system_time all;
select @@secure_timestamp;

--connection master

drop database test;
create database test;

--source include/rpl_end.inc
