--source suite/versioning/common.inc

create or replace table t1 (x int) with system versioning;
insert into t1 values (1), (2);
delete from t1 where x = 1;

--let $dumpfile= $MYSQLTEST_VARDIR/tmp/mysqldump.sql
--exec $MYSQL_DUMP --skip-create-options --skip-comments test t1 > $dumpfile

drop table t1;
--exec $MYSQL test < $dumpfile
show create table t1;
select *, check_row(row_start, row_end) from t1 for system_time all;

drop table t1;
--remove_file $dumpfile

--exit

#
# MDEV-15330 Server crash or assertion `table->insert_values' failure in write_record upon LOAD DATA
#
CREATE TABLE t1 (a INT, b INT, c INT, vc INT AS (c), UNIQUE(a), UNIQUE(b)) WITH SYSTEM VERSIONING;
INSERT IGNORE INTO t1 (a,b,c) VALUES (1,2,3);

SELECT a, b, c FROM t1 INTO OUTFILE '15330.data';
LOAD DATA INFILE '15330.data' IGNORE INTO TABLE t1 (a,b,c);
LOAD DATA INFILE '15330.data' REPLACE INTO TABLE t1 (a,b,c);

# Cleanup
DROP TABLE t1;

drop database test;
create database test;
