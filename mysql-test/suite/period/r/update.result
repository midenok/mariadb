create or replace table t (id int, s date, e date, period for apptime(s,e));
insert into t values(1, '1999-01-01', '2018-12-12');
insert into t values(1, '1999-01-01', '2017-01-01');
insert into t values(1, '2017-01-01', '2019-01-01');
insert into t values(2, '1998-01-01', '2018-12-12');
insert into t values(3, '1997-01-01', '2015-01-01');
insert into t values(4, '2016-01-01', '2020-01-01');
update t for portion of apptime from '2000-01-01' to '2018-01-01'
       set id=id + 5;
select * from t;
id	s	e
6	2000-01-01	2018-01-01
6	2000-01-01	2017-01-01
6	2017-01-01	2018-01-01
7	2000-01-01	2018-01-01
8	2000-01-01	2015-01-01
9	2016-01-01	2018-01-01
1	1999-01-01	2000-01-01
1	2018-01-01	2018-12-12
1	1999-01-01	2000-01-01
1	2018-01-01	2019-01-01
2	1998-01-01	2000-01-01
2	2018-01-01	2018-12-12
3	1997-01-01	2000-01-01
4	2018-01-01	2020-01-01
# Modify period start/end fields
truncate t;
insert into t values(1, '1999-01-01', '2018-12-12');
insert into t values(1, '1999-01-01', '2017-01-01');
update t for portion of apptime from '2000-01-01' to '2018-01-01'
       set id= id + 5, s=subdate(s, 5), e=adddate(e, 5);
select * from t;
id	s	e
6	1998-12-27	2018-12-17
6	1998-12-27	2017-01-06
1	1999-01-01	2000-01-01
1	2018-01-01	2018-12-12
1	1999-01-01	2000-01-01
# Precision timestamps
create or replace table t (id int, s timestamp(5), e timestamp(5),
period for apptime(s,e));
insert into t values(1, '1999-01-01', '2018-12-12');
insert into t values(1, '1999-01-01', '2017-01-01');
update t for portion of apptime from '2000-01-01 00:00:00.00015'
                                to '2018-01-01 12:34:56.31415'
         set s='1999-09-09 3:14:15.926535', id= id + 5;
select * from t;
id	s	e
6	1999-09-09 03:14:15.92653	2018-01-01 12:34:56.31415
6	1999-09-09 03:14:15.92653	2017-01-01 00:00:00.00000
1	1999-01-01 00:00:00.00000	2000-01-01 00:00:00.00015
1	2018-01-01 12:34:56.31415	2018-12-12 00:00:00.00000
1	1999-01-01 00:00:00.00000	2000-01-01 00:00:00.00015
# Strings
create or replace table t (id int, str text, s date, e date,
period for apptime(s,e));
insert into t values(1, 'data', '1999-01-01', '2018-12-12');
insert into t values(1, 'other data', '1999-01-01', '2018-12-12');
update t for portion of apptime from '2000-01-01' to '2018-01-01'
       set id= id + 5;
select * from t;
id	str	s	e
6	data	2000-01-01	2018-01-01
6	other data	2000-01-01	2018-01-01
1	data	1999-01-01	2000-01-01
1	data	2018-01-01	2018-12-12
1	other data	1999-01-01	2000-01-01
1	other data	2018-01-01	2018-12-12
# multi-table UPDATE is prohibited
create or replace table t1(x int);
update t for portion of apptime from '2000-01-01' to '2018-01-01', t1
set t.id= t.id + 5;
ERROR HY000: PORTION OF TIME is not allowed here
update t1 set x= (select id from t for portion of apptime from '2000-01-01' to '2018-01-01');
ERROR HY000: PORTION OF TIME is not allowed here
create or replace database test;
