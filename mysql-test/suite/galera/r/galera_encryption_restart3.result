connection node_2;
connection node_1;
call mtr.add_suppression("WSREP: GCache recovery is not supported when encryption is enabled. Recovery will be skipped.");
connection node_1;
connection node_2;
connection node_1;
# node_1
CREATE TABLE encryption(a INT primary key, b text) engine=innodb;
INSERT into encryption values (1, 'VerySecretMessage');
NOT FOUND /CREATE TABLE encryption\(a INT\)/ in galera.page.00000*
NOT FOUND /CREATE TABLE encryption\(a INT\)/ in galera.cache
NOT FOUND /VerySecretMessage/ in galera.page.00000*
NOT FOUND /VerySecretMessage/ in galera.cache
connection node_2;
# node_2
call mtr.add_suppression("WSREP: GCache recovery is not supported when encryption is enabled. Recovery will be skipped.");
show variables like 'encrypt_binlog';
Variable_name	Value
encrypt_binlog	ON
NOT FOUND /CREATE TABLE encryption\(a INT\)/ in galera.cache
NOT FOUND /VerySecretMessage/ in galera.page.00000*
NOT FOUND /VerySecretMessage/ in galera.cache
# Restart node 2 and change the key file
connection node_2;
# node_2
call mtr.add_suppression("WSREP: GCache recovery is not supported when encryption is enabled. Recovery will be skipped.");
show variables like 'encrypt_binlog';
Variable_name	Value
encrypt_binlog	ON
INSERT INTO encryption values (2, 'YetAnymoreSecret');
NOT FOUND /CREATE TABLE encryption\(a INT\)/ in galera.cache
NOT FOUND /VerySecretMessage/ in galera.page.00000*
NOT FOUND /VerySecretMessage/ in galera.cache
NOT FOUND /YetAnymoreSecret/ in galera.page.00000*
NOT FOUND /YetAnymoreSecret/ in galera.cache
connection node_1;
# node_1
NOT FOUND /CREATE TABLE encryption\(a INT\)/ in galera.page.00000*
NOT FOUND /CREATE TABLE encryption\(a INT\)/ in galera.cache
NOT FOUND /VerySecretMessage/ in galera.page.00000*
NOT FOUND /VerySecretMessage/ in galera.cache
NOT FOUND /YetAnymoreSecret/ in galera.page.00000*
NOT FOUND /YetAnymoreSecret/ in galera.cache
# Restart node 2 and change key file back
connection node_2;
call mtr.add_suppression("WSREP: GCache recovery is not supported when encryption is enabled. Recovery will be skipped.");
# node_2
show variables like 'encrypt_binlog';
Variable_name	Value
encrypt_binlog	ON
INSERT INTO encryption values (3, 'AgainMoreSecret');
NOT FOUND /CREATE TABLE encryption\(a INT\)/ in galera.cache
NOT FOUND /VerySecretMessage/ in galera.page.00000*
NOT FOUND /VerySecretMessage/ in galera.cache
NOT FOUND /YetAnymoreSecret/ in galera.page.00000*
NOT FOUND /YetAnymoreSecret/ in galera.cache
NOT FOUND /AgainMoreSecret/ in galera.page.00000*
NOT FOUND /AgainMoreSecret/ in galera.cache
connection node_1;
DROP TABLE encryption;
